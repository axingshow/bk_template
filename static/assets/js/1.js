webpackJsonp([1],{"1qKU":function(e,t){},A8gV:function(e,t){},Gbpi:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=s("aA9S"),r=s.n(a),i=s("HzJ8"),n=s.n(i),o=s("4YfN"),l=s.n(o),c=s("cMGX"),u=s("l0np"),h=s("HVJf"),d={components:{pagination:c.a,"new-edit":u.a},data:function(){return{loadingUser:!1,showForm:!0,showAdd:!1,dataUser:[],allUserName:[],allUser:[],optionsGroup:[],formUser:{username:"",phone:"",email:""},addUserId:"",authUserId:"",rulesUser:{},userDetail:[],userAuthorityList:[],valueGroup:[],stateUser:"",title:"",width:"35%",labelPosition:"120px",totalNumber:0,currentPage:1,pageSize:10}},created:function(){this.getUser(),this.search(),this.showAdd=this.requirePerm("add_bkuser")},computed:l()({},Object(h.b)("leftmenu",["permissions"])),methods:{requirePerm:function(e){var t=!0,s=!1,a=void 0;try{for(var r,i=n()(this.permissions);!(t=(r=i.next()).done);t=!0){if(r.value.codename==e)return!0}}catch(e){s=!0,a=e}finally{try{!t&&i.return&&i.return()}finally{if(s)throw a}}return!1},getUser:function(e){var t=this,s={page:this.currentPage,page_size:this.pageSize};s=r()(s,e),this.$store.dispatch("user/getTableUser",s).then(function(e){e.result&&(t.totalNumber=e.data.count,t.dataUser=e.data.items)})},pageSizeChange:function(e){this.currentPage=e.currentPage,this.pageSize=e.pageSize,this.getUser({page:this.currentPage,page_size:this.pageSize})},handleNewUser:function(){this.showForm=!0,this.formUser={},this.dialogAction="new",this.title="新建",this.$refs.newEdit.open()},handleAuthority:function(e){var t=this;this.showForm=!1,this.title="权限管理",this.$refs.newEdit.open(),this.authUserId=e.row.id;var s={id:this.authUserId};this.$store.dispatch("user/getUserAuthority",s).then(function(e){e.result&&(t.userAuthorityList=e.data)}),this.$store.dispatch("user/getAllGroup").then(function(e){e.result&&(t.optionsGroup=e.data)})},handleSuccess:function(){var e=this;if(1==this.showForm){var t={id:this.addUserId};this.$store.dispatch("user/addUser",t).then(function(t){t.result?(e.getUser(),e.$message({type:"success",message:"添加用户成功"})):e.$message({type:"error",message:"添加用户失败"})})}else if(0==this.showForm){var s={id:this.authUserId,params:this.userAuthorityList};this.$store.dispatch("user/setUserPerm",s).then(function(t){t.result?(e.getUser(),e.$message({type:"success",message:"设置用户权限成功"})):e.$message({type:"error",message:"设置用户权限失败"})})}this.$refs.newEdit.cancel()},checkboxChange:function(e){var t=this,s=e.is_enable?"是否启用":"是否禁用";this.$confirm(s,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){if(1==e.is_enable){var s={users:[e.id],enable:!0};t.$store.dispatch("user/usersStatus",s).then(function(s){s.result?t.$message({type:"success",message:s.message}):(e.is_enable=!e.is_enable,t.$message({type:"error",message:s.message}))})}else if(0==e.is_enable){var a={users:[e.id],enable:!1};t.$store.dispatch("user/usersStatus",a).then(function(s){s.result?t.$message({type:"success",message:s.message}):(e.is_enable=!e.is_enable,t.$message({type:"error",message:s.message}))})}}).catch(function(){e.is_enable=!e.is_enable,t.$message({type:"info",message:"调取接口失败"})})},handleDelete:function(e){var t=this;this.$confirm("此操作将永久删除, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var s={id:e.row.id};t.$store.dispatch("user/deleteUser",s).then(function(e){e.result?(t.getUser(),t.$message({type:"success",message:"删除用户成功"})):t.$message({type:"error",message:"删除用户失败"})})}).catch(function(){t.$message({type:"info",message:"已取消"})})},handleSelect:function(e){this.getUser({chname:e.value})},handleSelectDialog:function(e){this.addUserId=e.id,this.formUser.phone=e.phone,this.formUser.email=e.email},search:function(){var e=this;this.allUserName=[],this.$store.dispatch("group/getAllUser").then(function(t){if(t.result){var s=!0,a=!1,r=void 0;try{for(var i,o=n()(t.data);!(s=(i=o.next()).done);s=!0){var l=i.value;e.allUserName.push({value:l.chname}),e.userDetail.push({value:l.chname,phone:l.phone,email:l.email,id:l.id})}}catch(e){a=!0,r=e}finally{try{!s&&o.return&&o.return()}finally{if(a)throw r}}e.allUser=t.data}})},querySearchDetail:function(e,t){var s=this.userDetail;t(e?s.filter(this.createStateFilterDetail(e)):s)},createStateFilterDetail:function(e){return function(t){return 0===t.value.toLowerCase().indexOf(e.toLowerCase())}},querySearchAsync:function(e,t){var s=this.allUserName;t(e?s.filter(this.createStateFilter(e)):s)},createStateFilter:function(e){return function(t){return 0===t.value.toLowerCase().indexOf(e.toLowerCase())}}}},p={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"user"},[s("div",{staticClass:"search"},[s("el-autocomplete",{attrs:{"fetch-suggestions":e.querySearchAsync,placeholder:"请输入用户名",clearable:""},on:{select:e.handleSelect},model:{value:e.stateUser,callback:function(t){e.stateUser=t},expression:"stateUser"}})],1),e._v(" "),s("div",{staticClass:"new"},[e.showAdd?s("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.handleNewUser}},[e._v("添加用户")]):e._e(),e._v(" "),e.showAdd?e._e():s("el-button",{attrs:{size:"mini",type:"primary",disabled:""}},[e._v("添加用户")])],1),e._v(" "),s("div",{staticClass:"table"},[s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loadingUser,expression:"loadingUser"}],ref:"",staticStyle:{width:"100%"},attrs:{stripe:"",data:e.dataUser,height:"100%"}},[s("el-table-column",{attrs:{prop:"username",label:"用户名","show-overflow-tooltip":""}}),e._v(" "),s("el-table-column",{attrs:{prop:"chname",label:"中文名","show-overflow-tooltip":""}}),e._v(" "),s("el-table-column",{attrs:{prop:"phone",label:"电话","show-overflow-tooltip":""}}),e._v(" "),s("el-table-column",{attrs:{prop:"email",label:"邮箱","show-overflow-tooltip":""}}),e._v(" "),s("el-table-column",{attrs:{prop:"groups",label:"所属角色","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[s("span",[e._v(e._s(e._f("arrayFormat")(t.row.groups)))])]}}])}),e._v(" "),s("el-table-column",{attrs:{label:"是否启用"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-checkbox",{on:{change:function(s){return e.checkboxChange(t.row)}},model:{value:t.row.is_enable,callback:function(s){e.$set(t.row,"is_enable",s)},expression:"scope.row.is_enable"}})]}}])}),e._v(" "),s("el-table-column",{attrs:{prop:"handle",label:"操作",fixed:"right",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-button",{attrs:{type:"text"},on:{click:function(s){return e.handleAuthority(t)}}},[e._v("权限")]),e._v(" "),s("el-button",{attrs:{type:"text"},on:{click:function(s){return e.handleDelete(t)}}},[e._v("删除")])]}}])})],1)],1),e._v(" "),s("pagination",{attrs:{total:e.totalNumber},on:{"page-size-change":e.pageSizeChange}}),e._v(" "),s("new-edit",{ref:"newEdit",attrs:{title:e.title,"dialog-action":"dialogAction",width:e.width},on:{"handle-success":e.handleSuccess}},[e.showForm?s("div",{attrs:{slot:"dialog-content"},slot:"dialog-content"},[s("el-form",{ref:"formUser",attrs:{"label-position":e.labelPosition,"label-width":"120px",model:e.formUser,rules:e.rulesUser}},[s("el-form-item",{attrs:{label:"用户名",prop:"name"}},[s("el-autocomplete",{staticClass:"inline-input",attrs:{clearable:"",size:"small","fetch-suggestions":e.querySearchDetail,placeholder:"请输入用户名"},on:{select:e.handleSelectDialog},model:{value:e.formUser.username,callback:function(t){e.$set(e.formUser,"username",t)},expression:"formUser.username"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"电话",prop:"phone"}},[s("span",{staticClass:"form-content"},[e._v(e._s(e.formUser.phone))])]),e._v(" "),s("el-form-item",{attrs:{label:"邮箱",prop:"email"}},[s("span",{staticClass:"form-content"},[e._v(e._s(e.formUser.email))])])],1)],1):e._e(),e._v(" "),e.showForm?e._e():s("div",{attrs:{slot:"dialog-content"},slot:"dialog-content"},[s("div",e._l(e.userAuthorityList,function(t,a){return s("div",{key:a,staticClass:"label-position"},[s("label",{staticClass:"label-position-left"},[e._v(e._s(t.display_name))]),e._v(" "),s("div",{staticClass:"label-position-right"},[s("el-select",{attrs:{clearable:"",size:"mini",multiple:"",placeholder:"请选择角色"},model:{value:t.groups,callback:function(s){e.$set(t,"groups",s)},expression:"item.groups"}},e._l(e.optionsGroup,function(e,t){return s("el-option",{key:t,attrs:{label:e.label,value:e.value}})}),1)],1)])}),0)])])],1)},staticRenderFns:[]};var f=s("C7Lr")(d,p,!1,function(e){s("1qKU")},null,null);t.default=f.exports},MZmk:function(e,t){},cMGX:function(e,t,s){"use strict";var a={data:function(){return{currentPage:1,pageSize:10,pager:5}},props:{total:Number},methods:{handleSizeChange:function(e){this.pageSize=e,this.$emit("page-size-change",{pageSize:this.pageSize,currentPage:this.currentPage})},handleCurrentChange:function(e){this.currentPage=e,this.$emit("page-size-change",{pageSize:this.pageSize,currentPage:this.currentPage})}}},r={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{attrs:{id:"pagination"}},[t("el-pagination",{attrs:{"current-page":this.currentPage,"page-sizes":[10,20,50,100],"pager-count":this.pager,layout:"total, sizes, prev, pager, next, jumper",total:this.total},on:{"size-change":this.handleSizeChange,"current-change":this.handleCurrentChange}})],1)},staticRenderFns:[]};var i=s("C7Lr")(a,r,!1,function(e){s("MZmk")},null,null);t.a=i.exports},l0np:function(e,t,s){"use strict";var a={props:{title:{type:String,default:""},width:{type:String,default:""},dialogAction:{type:String,default:""}},data:function(){return{isShow:!1}},methods:{open:function(){this.isShow=!0},confirm:function(){this.$emit("handle-success",this.dialogAction)},cancel:function(){this.isShow=!1}}},r={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"dialog"},[s("el-dialog",{attrs:{title:e.title,visible:e.isShow,width:e.width},on:{"update:visible":function(t){e.isShow=t}}},[e._t("dialog-content"),e._v(" "),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.confirm}},[e._v("确 定")]),e._v(" "),s("el-button",{attrs:{size:"mini"},on:{click:e.cancel}},[e._v("取 消")])],1)],2)],1)},staticRenderFns:[]};var i=s("C7Lr")(a,r,!1,function(e){s("A8gV")},null,null);t.a=i.exports}});
//# sourceMappingURL=1.js.map