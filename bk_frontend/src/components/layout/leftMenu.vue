<template>
    <div id="left-menu">
        <el-row>
            <el-col :span="12">
                <el-menu
                router
                :default-active="currentMenu"
                background-color="rgb(4, 21, 39)"
                text-color="#fff"
                active-text-color="#ffd04b"
                :unique-opened="only">
                    <template v-for="(key, item) in $router.options.routes" :index="item">
                        <div v-if="item.menuShow" :key="key">
                            <el-submenu :index="item.path" :key="item.path" v-if="item.hasChild">
                                <template slot="title">
                                    <i class="el-icon-document"></i>
                                    <span>{{item.menuName}}</span>
                                </template>
                                <el-menu-item v-for="(itemChild, index) in item.children" :index="itemChild.path" :key="index">
                                    <span>{{itemChild.menuName}}</span>
                                </el-menu-item>
                            </el-submenu>
                            <el-menu-item :index="item.path" :key="item.path" v-else>
                                <i class="el-icon-view"></i>
                                <span>{{item.menuName}}</span>
                            </el-menu-item>
                        </div>
                    </template>
                </el-menu>
            </el-col>
        </el-row>
    </div>
</template>

<script>
    export default {
        data() {
            return {
                only: true,
                currentMenu: '/home'
            }
        },
       created() {
            this.getUrl()
            this.getLeftmenu()
        },
        methods: {
            getUrl() {
                /*
                * 刷新当前页面左侧对应菜单高亮
                * @param    currentUrl       当前url
                * @param    currentMenu      当前菜单
                */
                let self = this
                let currentUrl = window.location.href;
                self.currentMenu = currentUrl.split('#')[1];
            },
            getPath() {
                /*
                * 点击浏览器前进后退按钮高亮显示同步
                */
                let self = this
                self.currentMenu = self.$route.path;
            },
            getLeftmenu() {
                this.$store.dispatch('leftmenu/getMenu').then(res => {
                    if (res.result) {
                        console.log(res.data)
                    }
                })
            }
        },
        watch: {
            /*
            * 监听路由，当路由变化时，改变默认显示高亮的值
            */
            '$route': 'getPath'
        }
    }
</script>

<style lang="scss" scoped>
    #left-menu {
        width: 220px;
        height: calc(100% - 60px);
        float: left;
        .el-menu {
            border-right: none;
            width: 100%;
            height: 100%;
        }
        .el-row {
            width: 100%;
            height: 100%;
        }
        .el-row .el-col.el-col-12 {
            width: 100%;
            height: 100%;
            ul li span{
                margin-left: 20px;
            }
        }
    }
    #left-menu ul>li>div>span {
        margin-left: 20px;
    }
    #left-menu ul>li>span {
        margin-left: 20px;
    }
    .el-submenu .el-menu-item {
        padding-left: 90px !important;
    }
</style>
<style lang="scss">
    #left-menu .el-submenu.is-opened > .el-submenu__title {
        color: rgb(248, 209, 100) !important;
        i {
            color: rgb(248, 209, 100);
        }
    }
    #left-menu .el-submenu.is-opened .el-submenu__icon-arrow.el-icon-arrow-down {
        color: rgb(248, 209, 100) !important;
    }
</style>
